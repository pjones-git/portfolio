<!DOCTYPE HTML>
<html>
<head>
    <title>Website Content Editor - Miniport</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        .admin-container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 2rem; 
            background: #fff;
            margin-top: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .form-section { 
            margin-bottom: 3rem; 
            padding: 2rem; 
            border: 1px solid #e1e1e1; 
            border-radius: 8px; 
            background: #f9f9f9;
        }
        .form-section h2 { 
            color: #333; 
            border-bottom: 2px solid #4acaa8; 
            padding-bottom: 0.5rem; 
            margin-bottom: 1.5rem;
        }
        .form-group { 
            margin-bottom: 1.5rem; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 0.5rem; 
            font-weight: bold; 
            color: #555;
        }
        .form-group input, .form-group textarea, .form-group select { 
            width: 100%; 
            padding: 0.75rem; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            font-size: 1rem;
        }
        .form-group textarea { 
            resize: vertical; 
            min-height: 100px; 
        }
        .repeater-item { 
            background: #fff; 
            padding: 1.5rem; 
            margin-bottom: 1rem; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            position: relative;
        }
        .repeater-item h4 { 
            margin-top: 0; 
            color: #4acaa8;
        }
        .btn-remove { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: #e74c3c; 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            border-radius: 3px; 
            cursor: pointer;
        }
        .btn-add { 
            background: #4acaa8; 
            color: white; 
            border: none; 
            padding: 0.75rem 1.5rem; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-top: 1rem;
        }
        .btn-primary { 
            background: #4acaa8; 
            color: white; 
            border: none; 
            padding: 1rem 2rem; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 1.1rem; 
            margin-right: 1rem;
        }
        .btn-secondary { 
            background: #95a5a6; 
            color: white; 
            border: none; 
            padding: 1rem 2rem; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 1.1rem;
        }
        .form-actions { 
            text-align: center; 
            margin-top: 3rem; 
            padding-top: 2rem; 
            border-top: 2px solid #e1e1e1;
        }
        .file-upload { 
            position: relative; 
            display: inline-block; 
        }
        .file-upload-btn { 
            background: #3498db; 
            color: white; 
            padding: 0.5rem 1rem; 
            border-radius: 4px; 
            cursor: pointer; 
            border: none;
        }
        .file-upload input[type=file] { 
            position: absolute; 
            left: -9999px; 
        }
        .image-preview { 
            max-width: 200px; 
            max-height: 200px; 
            margin-top: 0.5rem; 
            border-radius: 4px;
        }
        .grid-2 { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 1rem; 
        }
        .grid-3 { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 1rem; 
        }
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
        .success-message, .error-message {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            display: none;
        }
        .success-message { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error-message { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="admin-container">
        <h1>Website Content Editor</h1>
        <p>Use this form to customize your website content. Changes will be applied immediately when you save.</p>
        
        <div id="success-message" class="success-message"></div>
        <div id="error-message" class="error-message"></div>

        <form id="content-form" enctype="multipart/form-data">
            <!-- Site Settings -->
            <div class="form-section">
                <h2>Site Settings</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="site-title">Site Title</label>
                        <input type="text" id="site-title" name="site[title]" required>
                    </div>
                    <div class="form-group">
                        <label for="meta-description">Meta Description</label>
                        <input type="text" id="meta-description" name="site[meta_description]">
                    </div>
                </div>
            </div>

            <!-- Personal Information -->
            <div class="form-section">
                <h2>Personal Information</h2>
                <div class="form-group">
                    <label for="personal-name">Your Name</label>
                    <input type="text" id="personal-name" name="personal[name]" required>
                </div>
                <div class="form-group">
                    <label for="personal-tagline">Personal Tagline/Bio</label>
                    <textarea id="personal-tagline" name="personal[tagline]" placeholder="Tell visitors about yourself"></textarea>
                </div>
                <div class="form-group">
                    <label for="profile-image">Profile Image</label>
                    <div class="file-upload">
                        <button type="button" class="file-upload-btn" onclick="document.getElementById('profile-image').click()">Choose Image</button>
                        <input type="file" id="profile-image" name="personal[profile_image]" accept="image/*" onchange="previewImage(this, 'profile-preview')">
                    </div>
                    <img id="profile-preview" class="image-preview" style="display: none;">
                </div>
                <div class="form-group">
                    <label for="personal-cta">Call-to-Action Text</label>
                    <input type="text" id="personal-cta" name="personal[cta_text]" placeholder="e.g., Learn about what I do">
                </div>
            </div>

            <!-- Work/Services Section -->
            <div class="form-section">
                <h2>Work/Services Section</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="work-title">Section Title</label>
                        <input type="text" id="work-title" name="work[title]" required>
                    </div>
                    <div class="form-group">
                        <label for="work-subtitle">Section Subtitle</label>
                        <input type="text" id="work-subtitle" name="work[subtitle]">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Services (You can have up to 6 services)</label>
                    <div id="services-container">
                        <!-- Services will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn-add" onclick="addService()">Add Service</button>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label for="work-footer">Footer Text</label>
                        <input type="text" id="work-footer" name="work[footer_text]">
                    </div>
                    <div class="form-group">
                        <label for="work-cta">Call-to-Action Text</label>
                        <input type="text" id="work-cta" name="work[cta_text]">
                    </div>
                </div>
            </div>

            <!-- Portfolio Section -->
            <div class="form-section">
                <h2>Portfolio Section</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="portfolio-title">Section Title</label>
                        <input type="text" id="portfolio-title" name="portfolio[title]" required>
                    </div>
                    <div class="form-group">
                        <label for="portfolio-subtitle">Section Subtitle</label>
                        <input type="text" id="portfolio-subtitle" name="portfolio[subtitle]">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Portfolio Items</label>
                    <div id="portfolio-container">
                        <!-- Portfolio items will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn-add" onclick="addPortfolioItem()">Add Portfolio Item</button>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label for="portfolio-footer">Footer Text</label>
                        <input type="text" id="portfolio-footer" name="portfolio[footer_text]">
                    </div>
                    <div class="form-group">
                        <label for="portfolio-cta">Call-to-Action Text</label>
                        <input type="text" id="portfolio-cta" name="portfolio[cta_text]">
                    </div>
                </div>
            </div>

            <!-- Contact Section -->
            <div class="form-section">
                <h2>Contact Section</h2>
                <div class="grid-2">
                    <div class="form-group">
                        <label for="contact-title">Section Title</label>
                        <input type="text" id="contact-title" name="contact[title]" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-subtitle">Section Subtitle</label>
                        <input type="text" id="contact-subtitle" name="contact[subtitle]">
                    </div>
                </div>
                <div class="form-group">
                    <label for="contact-form-action">Contact Form Action URL</label>
                    <input type="text" id="contact-form-action" name="contact[form_action]" placeholder="e.g., mailto:your@email.com or contact.php">
                </div>
                
                <div class="form-group">
                    <label>Social Media Links</label>
                    <div id="social-container">
                        <!-- Social links will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn-add" onclick="addSocialLink()">Add Social Link</button>
                </div>
            </div>

            <!-- Navigation -->
            <div class="form-section">
                <h2>Navigation</h2>
                <div class="form-group">
                    <label>Navigation Items</label>
                    <div id="navigation-container">
                        <!-- Navigation items will be populated by JavaScript -->
                    </div>
                    <button type="button" class="btn-add" onclick="addNavItem()">Add Navigation Item</button>
                </div>
            </div>

            <!-- Copyright -->
            <div class="form-section">
                <h2>Footer/Copyright</h2>
                <div class="grid-3">
                    <div class="form-group">
                        <label for="copyright-text">Copyright Text</label>
                        <input type="text" id="copyright-text" name="copyright[text]">
                    </div>
                    <div class="form-group">
                        <label for="design-credit">Design Credit</label>
                        <input type="text" id="design-credit" name="copyright[design_credit]">
                    </div>
                    <div class="form-group">
                        <label for="design-url">Design Credit URL</label>
                        <input type="url" id="design-url" name="copyright[design_url]">
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-primary" onclick="saveContent()">Save Changes</button>
                <button type="button" class="btn-primary" onclick="previewSite()">Preview Site</button>
                <button type="button" class="btn-secondary" onclick="resetForm()">Reset Form</button>
                <button type="button" class="btn-secondary" onclick="backupContent()">Backup Current</button>
            </div>
        </form>
    </div>

    <script src="assets/js/jquery.min.js"></script>
    <script>
        let currentConfig = {};
        let serviceIndex = 0;
        let portfolioIndex = 0;
        let socialIndex = 0;
        let navIndex = 0;

        // Load current configuration
        async function loadCurrentConfig() {
            try {
                const response = await fetch('content-config.json');
                currentConfig = await response.json();
                populateForm();
            } catch (error) {
                console.error('Error loading config:', error);
                showError('Failed to load current configuration');
            }
        }

        // Populate form with current data
        function populateForm() {
            // Site settings
            document.getElementById('site-title').value = currentConfig.site?.title || '';
            document.getElementById('meta-description').value = currentConfig.site?.meta_description || '';
            
            // Personal info
            document.getElementById('personal-name').value = currentConfig.personal?.name || '';
            document.getElementById('personal-tagline').value = currentConfig.personal?.tagline || '';
            document.getElementById('personal-cta').value = currentConfig.personal?.cta_text || '';
            
            // Work section
            document.getElementById('work-title').value = currentConfig.work?.title || '';
            document.getElementById('work-subtitle').value = currentConfig.work?.subtitle || '';
            document.getElementById('work-footer').value = currentConfig.work?.footer_text || '';
            document.getElementById('work-cta').value = currentConfig.work?.cta_text || '';
            
            // Portfolio section
            document.getElementById('portfolio-title').value = currentConfig.portfolio?.title || '';
            document.getElementById('portfolio-subtitle').value = currentConfig.portfolio?.subtitle || '';
            document.getElementById('portfolio-footer').value = currentConfig.portfolio?.footer_text || '';
            document.getElementById('portfolio-cta').value = currentConfig.portfolio?.cta_text || '';
            
            // Contact section
            document.getElementById('contact-title').value = currentConfig.contact?.title || '';
            document.getElementById('contact-subtitle').value = currentConfig.contact?.subtitle || '';
            document.getElementById('contact-form-action').value = currentConfig.contact?.form_action || '';
            
            // Copyright
            document.getElementById('copyright-text').value = currentConfig.copyright?.text || '';
            document.getElementById('design-credit').value = currentConfig.copyright?.design_credit || '';
            document.getElementById('design-url').value = currentConfig.copyright?.design_url || '';
            
            // Populate repeating sections
            populateServices();
            populatePortfolio();
            populateSocialLinks();
            populateNavigation();
        }

        // Services functions
        function populateServices() {
            const container = document.getElementById('services-container');
            container.innerHTML = '';
            serviceIndex = 0;
            
            if (currentConfig.work?.services) {
                currentConfig.work.services.forEach(service => {
                    addService(service);
                });
            }
        }

        function addService(data = null) {
            const container = document.getElementById('services-container');
            const index = serviceIndex++;
            
            const serviceDiv = document.createElement('div');
            serviceDiv.className = 'repeater-item';
            serviceDiv.innerHTML = `
                <h4>Service ${index + 1}</h4>
                <button type="button" class="btn-remove" onclick="removeService(this)">Remove</button>
                <div class="grid-3">
                    <div class="form-group">
                        <label>FontAwesome Icon Class</label>
                        <input type="text" name="work[services][${index}][icon]" value="${data?.icon || ''}" placeholder="e.g., fa-comments">
                    </div>
                    <div class="form-group">
                        <label>Service Title</label>
                        <input type="text" name="work[services][${index}][title]" value="${data?.title || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" name="work[services][${index}][icon_solid]" ${data?.icon_solid ? 'checked' : ''}>
                            Solid Icon Style
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Service Description</label>
                    <textarea name="work[services][${index}][description]" required>${data?.description || ''}</textarea>
                </div>
            `;
            
            container.appendChild(serviceDiv);
        }

        function removeService(button) {
            button.parentElement.remove();
        }

        // Portfolio functions
        function populatePortfolio() {
            const container = document.getElementById('portfolio-container');
            container.innerHTML = '';
            portfolioIndex = 0;
            
            if (currentConfig.portfolio?.items) {
                currentConfig.portfolio.items.forEach(item => {
                    addPortfolioItem(item);
                });
            }
        }

        function addPortfolioItem(data = null) {
            const container = document.getElementById('portfolio-container');
            const index = portfolioIndex++;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'repeater-item';
            itemDiv.innerHTML = `
                <h4>Portfolio Item ${index + 1}</h4>
                <button type="button" class="btn-remove" onclick="removePortfolioItem(this)">Remove</button>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Project Title</label>
                        <input type="text" name="portfolio[items][${index}][title]" value="${data?.title || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Project Link</label>
                        <input type="url" name="portfolio[items][${index}][link]" value="${data?.link || ''}" placeholder="https://...">
                    </div>
                </div>
                <div class="form-group">
                    <label>Project Description</label>
                    <textarea name="portfolio[items][${index}][description]" required>${data?.description || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>Project Image</label>
                    <div class="file-upload">
                        <button type="button" class="file-upload-btn" onclick="document.getElementById('portfolio-image-${index}').click()">Choose Image</button>
                        <input type="file" id="portfolio-image-${index}" name="portfolio[items][${index}][image_file]" accept="image/*" onchange="previewImage(this, 'portfolio-preview-${index}')">
                    </div>
                    <input type="hidden" name="portfolio[items][${index}][image]" value="${data?.image || ''}">
                    <img id="portfolio-preview-${index}" class="image-preview" src="${data?.image || ''}" style="${data?.image ? '' : 'display: none;'}">
                </div>
            `;
            
            container.appendChild(itemDiv);
        }

        function removePortfolioItem(button) {
            button.parentElement.remove();
        }

        // Social links functions
        function populateSocialLinks() {
            const container = document.getElementById('social-container');
            container.innerHTML = '';
            socialIndex = 0;
            
            if (currentConfig.contact?.social_links) {
                currentConfig.contact.social_links.forEach(link => {
                    addSocialLink(link);
                });
            }
        }

        function addSocialLink(data = null) {
            const container = document.getElementById('social-container');
            const index = socialIndex++;
            
            const linkDiv = document.createElement('div');
            linkDiv.className = 'repeater-item';
            linkDiv.innerHTML = `
                <h4>Social Link ${index + 1}</h4>
                <button type="button" class="btn-remove" onclick="removeSocialLink(this)">Remove</button>
                <div class="grid-3">
                    <div class="form-group">
                        <label>Platform Name</label>
                        <input type="text" name="contact[social_links][${index}][platform]" value="${data?.platform || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Profile URL</label>
                        <input type="url" name="contact[social_links][${index}][url]" value="${data?.url || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>FontAwesome Icon</label>
                        <input type="text" name="contact[social_links][${index}][icon]" value="${data?.icon || ''}" placeholder="e.g., fa-twitter">
                    </div>
                </div>
            `;
            
            container.appendChild(linkDiv);
        }

        function removeSocialLink(button) {
            button.parentElement.remove();
        }

        // Navigation functions
        function populateNavigation() {
            const container = document.getElementById('navigation-container');
            container.innerHTML = '';
            navIndex = 0;
            
            if (currentConfig.navigation) {
                currentConfig.navigation.forEach(item => {
                    addNavItem(item);
                });
            }
        }

        function addNavItem(data = null) {
            const container = document.getElementById('navigation-container');
            const index = navIndex++;
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'repeater-item';
            itemDiv.innerHTML = `
                <h4>Navigation Item ${index + 1}</h4>
                <button type="button" class="btn-remove" onclick="removeNavItem(this)">Remove</button>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Menu Label</label>
                        <input type="text" name="navigation[${index}][label]" value="${data?.label || ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Link Target</label>
                        <input type="text" name="navigation[${index}][href]" value="${data?.href || ''}" required placeholder="e.g., #section or https://...">
                    </div>
                </div>
            `;
            
            container.appendChild(itemDiv);
        }

        function removeNavItem(button) {
            button.parentElement.remove();
        }

        // Image preview function
        function previewImage(input, previewId) {
            const file = input.files[0];
            const preview = document.getElementById(previewId);
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Save content function
        async function saveContent() {
            const formData = new FormData(document.getElementById('content-form'));
            
            try {
                const response = await fetch('update-content.php', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    showSuccess('Content saved successfully!');
                    loadCurrentConfig(); // Reload to show updated data
                } else {
                    throw new Error('Failed to save content');
                }
            } catch (error) {
                console.error('Error saving content:', error);
                showError('Failed to save content. Please try again.');
            }
        }

        // Preview site function
        function previewSite() {
            window.open('preview.html', '_blank');
        }

        // Reset form function
        function resetForm() {
            if (confirm('Are you sure you want to reset all changes? This will reload the current saved content.')) {
                loadCurrentConfig();
            }
        }

        // Backup content function
        async function backupContent() {
            try {
                const response = await fetch('backup-content.php', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showSuccess('Content backed up successfully to: ' + result.filename);
                } else {
                    throw new Error('Failed to create backup');
                }
            } catch (error) {
                console.error('Error creating backup:', error);
                showError('Failed to create backup. Please try again.');
            }
        }

        // Utility functions
        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
            
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentConfig();
        });
    </script>
</body>
</html>
